<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
          "http://www.w3.org/TR/html40/loose.dtd">

<html>
         
  <head>
    <title>Class: Dispatch</title>
  </head>

  <body bgcolor="#ffffff">

        <p><i><a href="../../../../index.html">Table of Contents</a></i></p>
        
        <table border="0" cellpadding="5" cellspacing="0" width="100%">
        <tr>
            <th rowspan="2"
                valign="top"
                align="left"
                width="10%"
                bgcolor="#88bbee"><font color="#000000">Class: Dispatch</font>
            </th>
            <th bgcolor="#88bbee"
                width="90%"
                align="right"><font color="#000000">./src/peak/util/dispatch.py</font>
            </th>
        </tr>
        <tr>
        <td>
        
<h3>Mapping from rules to objects (slow, but simple)</h3>
<p>    This is a generic rule-driven lookup table that finds the &quot;closest matches&quot;
    based on whether a supplied key matches rules in the table, returning
    results for the most-specific rules first.  It can be used to
    implement business rules, stylesheets, generic functions, multimethods,
    or anything else you can think of that needs prioritized rule-driven
    matching.  All you need are objects that implement the <code>IRule</code> interface
    to act as rules, and the <code>Dispatch</code> class automatically handles issues
    like overlapping rules.</p>
<p>    Note that <code>Dispatch</code> objects are &quot;write until read&quot;, so once you use
    a dispatch table to process an object, you can no longer change its rules.</p>
<p>    Usage:
<pre>
        # Dispatcher that doesn't hold references to looked-up objects
        dispatcher = Dispatch(WeakKeyDictionary())
        dispatcher[aBusinesRule] = actionToTake

        # Retrieve action for closest match -- error if none found or ambiguous
        actionToTake = dispatcher[aBusinessObject].next()
</pre>
</p>
<h4>    Performance</h4>
<p>        The principal drawback of this class is speed.  Although lookups are
        cached, each new uncached lookup requires a loop over all the rules in
        the table, with each rule being asked to match the key being looked up.
        Then, the matching rules are sorted to put them in &quot;closest-match-first&quot;
        order, and this uses many function calls per comparison.</p>
<p>        However, for many simple applications of rule-based dispatching (such
        as multiple-dispatch of generic functions), where there aren't too many
        rules and even fewer that match on any given lookup, performance should
        be acceptable.  For more complex applications, you'll want a more
        sophisticated dispatcher that has internal indexes for its rules.  But,
        you can always use this dispatcher as a prototype to get the rest of
        your system figured out first.</p>
<table border="0" cellpadding="5" cellspacing="0" width="100%">

        <tr>
            <th bgcolor="#99ccff"
                rowspan="2"
                valign="top"
                align="left"
                width="20%"
                >
                <font color="#000000">
                  <a name="Base Classes">Base Classes</a>&nbsp;
                </font>
            </th>
            <th bgcolor="#99ccff"
                valign="top"
                align="left"
                width="80%"
                >
                <font color="#000000">&nbsp;</font>
            </th>
        </tr>
        <tr>
        <td>
        
object<br>

</td></tr>
</table>
<table border="0" cellpadding="5" cellspacing="0" width="100%">

        <tr>
            <th bgcolor="#99ccff"
                rowspan="2"
                valign="top"
                align="left"
                width="20%"
                >
                <font color="#000000">
                  <a name="Methods">Methods</a>&nbsp;
                </font>
            </th>
            <th bgcolor="#99ccff"
                valign="top"
                align="left"
                width="80%"
                >
                <font color="#000000">&nbsp;</font>
            </th>
        </tr>
        <tr>
        <td>
        
<a href="#__getitem__">__getitem__</a><br>
<a href="#__init__">__init__</a><br>
<a href="#__setitem__">__setitem__</a><br>


        <tr>
            <th bgcolor="#99ccff"
                rowspan="2"
                valign="top"
                align="left"
                width="20%"
                >
                <font color="#000000">
                  <a name="__getitem__"></a>&nbsp;
                </font>
            </th>
            <th bgcolor="#99ccff"
                valign="top"
                align="left"
                width="80%"
                >
                <font color="#000000">__getitem__&nbsp;</font>
            </th>
        </tr>
        <tr>
        <td>
        <font color="#000088"><pre>
__getitem__ ( self,  key )

</pre></font>

<h3>Return an iterator over the results for rules matching <code>key</code></h3>
<p>        Raises <code>NoMatchError</code> if no rules match <code>key</code>.  The iterator will
        raise <code>AmbiguousRulesError</code> if it is advanced to a point where match
        precedence is ambiguous.  This may be as early as the very first match,
        if there is no match which is unambiguously &quot;closest&quot; to <code>key</code>.</p>
<table border="0" cellpadding="5" cellspacing="0" width="100%">

        <tr>
            <th bgcolor="#99ccff"
                rowspan="2"
                valign="top"
                align="left"
                width="20%"
                >
                <font color="#000000">
                  <a name="Exceptions">Exceptions</a>&nbsp;
                </font>
            </th>
            <th bgcolor="#99ccff"
                valign="top"
                align="left"
                width="80%"
                >
                <font color="#000000">&nbsp;</font>
            </th>
        </tr>
        <tr>
        <td>
        
NoMatchError( "No match found", key )<br>

</td></tr>
</table>

        <tr>
            <th bgcolor="#99ccff"
                rowspan="2"
                valign="top"
                align="left"
                width="20%"
                >
                <font color="#000000">
                  <a name="__init__"></a>&nbsp;
                </font>
            </th>
            <th bgcolor="#99ccff"
                valign="top"
                align="left"
                width="80%"
                >
                <font color="#000000">__init__&nbsp;</font>
            </th>
        </tr>
        <tr>
        <td>
        <font color="#000088"><pre>
__init__ (
        self,
        items=(),
        cache=None,
        )

</pre></font>

<h3>Create dispatcher from <code>items</code>, optionally supplying a lookup cache</h3>
<p>        The default cache type for <code>Dispatch</code> objects is a dictionary, so
        all values looked up are cached permanently - not a good idea for
        many applications.  You can change this by supplying a cache object
        of your choice.  The cache must provide <code>__getitem__</code> and
        <code>__setitem__</code> methods.</p>
<p>        The <code>items</code> parameter, if supplied, should be a sequence of
        <code>(rule,result)</code> tuples to initially populate the dispatcher.</p>

        <tr>
            <th bgcolor="#99ccff"
                rowspan="2"
                valign="top"
                align="left"
                width="20%"
                >
                <font color="#000000">
                  <a name="__setitem__"></a>&nbsp;
                </font>
            </th>
            <th bgcolor="#99ccff"
                valign="top"
                align="left"
                width="80%"
                >
                <font color="#000000">__setitem__&nbsp;</font>
            </th>
        </tr>
        <tr>
        <td>
        <font color="#000088"><pre>
__setitem__ (
        self,
        rule,
        result,
        )

</pre></font>

<p>Store <code>result</code> as output for <code>rule</code></p>
</td></tr>
</td></tr>
</table>

        </td>
        </tr>
        </table>

        <hr>

        <p><i><a href="../../../../index.html">Table of Contents</a></i></p>

        <font size="-2"><i>This document was automatically generated
        on Tue Feb 17 19:55:52 2004 by
        <a href="http://happydoc.sourceforge.net">HappyDoc</a> version
        2.1</i></font>
        
        </body>
        </html>
        